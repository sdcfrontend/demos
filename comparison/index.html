<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<style>
  * {
    padding: 0;
    margin: 0;
    box-sizing: border-box
  }

  html {
    font-size: calc(14px + 1.4vw);
  }

  @media (min-width:928px) {
    html {
      font-size: 25px
    }
  }


  body {
    background: #eee;
    font-family: sans-serif;
    text-align: center;
    padding: 2vw;
  }

  .h2h {
    background: white;
  }

  .h2h__rail {
    overflow: auto;
  }

  .h2h__rail:before {
    content: "Swipe â†”";
    font-weight: 500;
    color: white;
    background: rgba(0, 0, 0, 0.3) no-repeat;
    background-size: 30px 25px;
    background-position: 100% 50%;
    border-radius: 12px;
    padding: 4px 9px;
    position: absolute;
    right: 10px;
    top: 50%;
    z-index: 10;
    transform: translateY(calc(-100% - 2rem));
    pointer-events: none;
    transition: opacity .5s;
    font-size: 0.7rem;
    visibility: hidden;
  }

  .h2h__rail[data-swipable]:before {
    visibility: visible
  }

  .h2h__canvas {
    position: relative;
    position: relative;
    height: 80vh;
    display: -ms-grid;
    display: grid;
    -ms-grid-columns: min-content 1fr;
    -ms-grid-rows: 1fr min-content min-content;
    grid-template-columns: min-content 1fr;
    grid-template-rows: 1fr min-content min-content;
    margin: 0 auto;
  }

  .h2h__pos {
    -ms-grid-column: 1;
    grid-column: 1;
    display: flex;
    position: relative;
    position: sticky;
    left: 0;
    flex-direction: column;
    border-right: 1px solid #ccc;
    background: white;
    align-items: flex-end;
    height: calc(100%);
    z-index: 4;
    box-shadow: 3px 0 rgba(0, 0, 0, 0.04)
  }

  .h2h__pos>span {
    padding-right: 0.75em;
    flex: 1;
    width: 100%;
    font-size: 0.65rem;
    color: #aaa;
    display: flex;
    align-items: flex-end;
    justify-content: flex-end
  }

  .h2h__body {
    -ms-grid-column: 2;
    grid-column: 2;
    border-top: 0;
    border-right: 0;
    border-bottom: 1px solid #ccc;
    position: relative;
    background: white;
  }

  .h2h__body-div {
    position: absolute;
    z-index: 1;
    width: 100%;
    height: 1px;
    background: #eee;
  }

  .h2h__body-div[data-pos="1"] {
    top: 5%;
  }

  .h2h__body-div[data-pos="5"] {
    top: 25%;
  }

  .h2h__body-div[data-pos="10"] {
    top: 50%;
  }

  .h2h__body-div[data-pos="15"] {
    top: 75%;
  }

  .h2h__body-div--relegation {
    height: calc(10%);
    background: #eee;
    bottom: 0;
    border-top: 1px solid #ddd
  }

  .h2h__year {
    -ms-grid-column: 2;
    -ms-grid-row: 3;
    grid-column: 2;
    grid-row: 3;
    display: flex;
    justify-content: space-between;
  }

  .h2h__year>span {
    padding: 1em 0;
    font-size: 0.65rem;
    color: #aaa
  }

  .h2h__overflow {
    -ms-grid-column: 2;
    -ms-grid-row: 2;
    grid-column: 2;
    grid-row: 2;
    height: 1px;
    /* background: #eee; */
  }

  .h2h__point {
    width: 24px;
    height: 24px;
    background: #ccc;
    border-radius: 50%;
    position: absolute;
    z-index: 3;
    transform: translate(-50%, -50%);
    color: #222;
    font-size: 0.6rem;
    display: flex;
    line-height: 0;
    justify-content: center;
    align-items: center;
    transition: transform 0.33s;
    transform-origin: center;
    cursor: pointer;
  }

  .h2h__point.animate-in-view {
    transform: scale(0)
  }

  .h2h__line {
    width: 2px;
    height: 2px;
    background: #ccc;
    position: absolute;
    z-index: 2;
    transform-origin: 0;
    transition: width 0.33s
  }

  .h2h__line.animate-in-view {
    width: 2px !important;
  }

  .h2h__line:not([style]) {
    display: none;
  }

  [data-label="home"] {
    background: black;
    color: white;
  }

  [data-label="away"] {
    background: #ccc;
    color: #222;
  }

  .h2h__tooltip {
    pointer-events: none;
    background: black;
    color: white;
    padding: 0.75em;
    position: absolute;
    z-index: 11;
    transform: translate(-50%, -100%);
    margin-top: -10px;
    transition: opacity 0.166s;
    white-space: pre-line;
    font-size: 14px;
    text-align: left;
    line-height: 1.2;
    left: -10000px
  }

  .h2h__tooltip:after {
    content: "";
    display: block;
    width: 8px;
    height: 8px;
    transform: rotate(-45deg);
    left: calc(50% - 4px);
    top: calc(100% - 4px);
    position: absolute;
    background: inherit;
  }
</style>

<body>
  <div>
    <span data-label="home">team 1</span>
    <select name="" id="home">
      <option value="0">Everton</option>
      <option value="1">Liverpool</option>
      <option value="2">Arsenal</option>
      <option value="3">Tottenham</option>
      <option value="4">Chelsea</option>
      <option value="5">Man Utd</option>
      <option value="6">Man City</option>
    </select>
    <span data-label="away">team 2</span>
    <select name="" id="away">
      <option value="0">Everton</option>
      <option value="1" selected>Liverpool</option>
      <option value="2">Arsenal</option>
      <option value="3">Tottenham</option>
      <option value="4">Chelsea</option>
      <option value="5">Man Utd</option>
      <option value="6">Man City</option>
    </select>
  </div>
  <div class="h2h">
    <div class="h2h__rail">
      <div class="h2h__canvas">
        <div class="h2h__pos">
          <span>1</span>
          <span></span>
          <span></span>
          <span></span>
          <span>5</span>
          <span></span>
          <span></span>
          <span></span>
          <span></span>
          <span>10</span>
          <span></span>
          <span></span>
          <span></span>
          <span></span>
          <span>15</span>
          <span></span>
          <span></span>
          <span></span>
          <span></span>
          <span>20</span>

        </div>
        <div class="h2h__body">
          <div class="h2h__body-div" data-pos="1"></div>
          <div class="h2h__body-div" data-pos="5"></div>
          <div class="h2h__body-div" data-pos="10"></div>
          <div class="h2h__body-div" data-pos="15"></div>
          <div class="h2h__body-div h2h__body-div--relegation"></div>
        </div>
        <div class="h2h__overflow"></div>
        <div class="h2h__year">
          <span>1992/93</span>
          <span>1997/98</span>
          <span>2002/03</span>
          <span>2007/08</span>
          <span>2012/13</span>
          <span>2017/18</span>
        </div>
      </div>
    </div>
  </div>

  <div class="h2h__tooltip"></div>



  <script>
    NodeList.prototype.forEach = Array.prototype.forEach;

    var data = {
      teams: [{ "positions": 20, "max": 20, "years": [{ "pos": "13", "points": "53" }, { "pos": "17", "points": "44" }, { "pos": "15", "points": "50" }, { "pos": "6", "points": "61" }, { "pos": "15", "points": "42" }, { "pos": "17", "points": "40" }, { "pos": "14", "points": "43" }, { "pos": "13", "points": "50" }, { "pos": "16", "points": "42" }, { "pos": "15", "points": "43" }, { "pos": "7", "points": "59" }, { "pos": "17", "points": "39" }, { "pos": "4", "points": "61" }, { "pos": "11", "points": "50" }, { "pos": "6", "points": "58" }, { "pos": "5", "points": "65" }, { "pos": "5", "points": "63" }, { "pos": "8", "points": "61" }, { "pos": "7", "points": "54" }, { "pos": "7", "points": "56" }, { "pos": "6", "points": "63" }, { "pos": "5", "points": "72" }, { "pos": "11", "points": "47" }, { "pos": "11", "points": "47" }, { "pos": "7", "points": "61" }, { "pos": "8", "points": "49" }] }, { "positions": 20, "max": 20, "years": [{ "pos": 6, "points": "59" }, { "pos": 8, "points": "60" }, { "pos": 4, "points": "74" }, { "pos": 3, "points": "71" }, { "pos": 4, "points": "68" }, { "pos": 3, "points": "65" }, { "pos": 7, "points": "54" }, { "pos": 4, "points": "67" }, { "pos": 3, "points": "69" }, { "pos": 2, "points": "80" }, { "pos": 5, "points": "64" }, { "pos": 4, "points": "60" }, { "pos": 5, "points": "58" }, { "pos": 3, "points": "82" }, { "pos": 3, "points": "68" }, { "pos": 4, "points": "76" }, { "pos": 2, "points": "86" }, { "pos": 7, "points": "63" }, { "pos": 6, "points": "58" }, { "pos": 8, "points": "52" }, { "pos": 7, "points": "61" }, { "pos": 2, "points": "84" }, { "pos": 6, "points": "62" }, { "pos": 8, "points": "60" }, { "pos": 4, "points": "76" }, { "pos": 4, "points": "75" }] }, { "positions": 20, "max": 20, "years": [{ "pos": 10, "points": "56" }, { "pos": 4, "points": "71" }, { "pos": 12, "points": "51" }, { "pos": 5, "points": "63" }, { "pos": 3, "points": "68" }, { "pos": 1, "points": "78" }, { "pos": 2, "points": "78" }, { "pos": 2, "points": "73" }, { "pos": 2, "points": "70" }, { "pos": 1, "points": "87" }, { "pos": 2, "points": "78" }, { "pos": 1, "points": "90" }, { "pos": 2, "points": "83" }, { "pos": 4, "points": "67" }, { "pos": 4, "points": "68" }, { "pos": 3, "points": "83" }, { "pos": 4, "points": "72" }, { "pos": 3, "points": "75" }, { "pos": 4, "points": "68" }, { "pos": 3, "points": "70" }, { "pos": 4, "points": "73" }, { "pos": 4, "points": "79" }, { "pos": 3, "points": "75" }, { "pos": 2, "points": "71" }, { "pos": 5, "points": "75" }, { "pos": 6, "points": "63" }] }, { "positions": 20, "max": 20, "years": [{ "pos": 16, "points": "66" }, { "pos": 15, "points": "45" }, { "pos": 7, "points": "62" }, { "pos": 8, "points": "61" }, { "pos": 10, "points": "46" }, { "pos": 14, "points": "44" }, { "pos": 11, "points": "47" }, { "pos": 10, "points": "53" }, { "pos": 12, "points": "49" }, { "pos": 9, "points": "50" }, { "pos": 10, "points": "50" }, { "pos": 14, "points": "45" }, { "pos": 9, "points": "52" }, { "pos": 5, "points": "65" }, { "pos": 5, "points": "60" }, { "pos": 11, "points": "46" }, { "pos": 8, "points": "51" }, { "pos": 4, "points": "70" }, { "pos": 5, "points": "62" }, { "pos": 4, "points": "69" }, { "pos": 5, "points": "72" }, { "pos": 6, "points": "69" }, { "pos": 5, "points": "64" }, { "pos": 3, "points": "70" }, { "pos": 2, "points": "86" }, { "pos": 3, "points": "77" }] }, { "positions": 20, "max": 20, "years": [{ "pos": 11, "points": "56" }, { "pos": 14, "points": "51" }, { "pos": 11, "points": "54" }, { "pos": 11, "points": "50" }, { "pos": 6, "points": "59" }, { "pos": 4, "points": "63" }, { "pos": 3, "points": "75" }, { "pos": 5, "points": "65" }, { "pos": 6, "points": "61" }, { "pos": 6, "points": "64" }, { "pos": 4, "points": "67" }, { "pos": 2, "points": "79" }, { "pos": 1, "points": "95" }, { "pos": 1, "points": "91" }, { "pos": 2, "points": "83" }, { "pos": 2, "points": "85" }, { "pos": 3, "points": "83" }, { "pos": 1, "points": "86" }, { "pos": 2, "points": "71" }, { "pos": 6, "points": "64" }, { "pos": 3, "points": "75" }, { "pos": 3, "points": "82" }, { "pos": 1, "points": "87" }, { "pos": 10, "points": "50" }, { "pos": 1, "points": "93" }, { "pos": 5, "points": "70" }] }, { "positions": 20, "max": 20, "years": [{ "pos": 1, "points": "84" }, { "pos": 1, "points": "92" }, { "pos": 2, "points": "88" }, { "pos": 1, "points": "82" }, { "pos": 1, "points": "75" }, { "pos": 2, "points": "77" }, { "pos": 1, "points": "79" }, { "pos": 1, "points": "91" }, { "pos": 1, "points": "80" }, { "pos": 3, "points": "77" }, { "pos": 1, "points": "83" }, { "pos": 3, "points": "75" }, { "pos": 3, "points": "77" }, { "pos": 2, "points": "83" }, { "pos": 1, "points": "89" }, { "pos": 1, "points": "87" }, { "pos": 1, "points": "90" }, { "pos": 2, "points": "85" }, { "pos": 1, "points": "80" }, { "pos": 2, "points": "89" }, { "pos": 1, "points": "89" }, { "pos": 7, "points": "64" }, { "pos": 4, "points": "70" }, { "pos": 5, "points": "66" }, { "pos": 6, "points": "69" }, { "pos": 2, "points": "81" }] }, { "positions": 20, "max": 47, "years": [{ "pos": 9, "points": "57" }, { "pos": 16, "points": "45" }, { "pos": 17, "points": "49" }, { "pos": 18, "points": "38" }, { "pos": 34, "points": "61" }, { "pos": 42, "points": "48" }, { "pos": 47, "points": "82" }, { "pos": 22, "points": "89" }, { "pos": 18, "points": "34" }, { "pos": 21, "points": "99" }, { "pos": 9, "points": "51" }, { "pos": 16, "points": "41" }, { "pos": 8, "points": "52" }, { "pos": 15, "points": "43" }, { "pos": 14, "points": "42" }, { "pos": 9, "points": "55" }, { "pos": 10, "points": "50" }, { "pos": 5, "points": "67" }, { "pos": 3, "points": "71" }, { "pos": 1, "points": "89" }, { "pos": 2, "points": "78" }, { "pos": 1, "points": "86" }, { "pos": 2, "points": "79" }, { "pos": 4, "points": "66" }, { "pos": 3, "points": "78" }, { "pos": 1, "points": "100" }] }]
    };

    var rail = document.querySelector('.h2h__rail');
    var body = document.querySelector('.h2h__body');
    var overflow = document.querySelector('.h2h__overflow');
    var canvas = document.querySelector('.h2h__canvas');
    var tooltip = document.querySelector('.h2h__tooltip');
    var currentdata = {};
    var points = {};
    var lines = {};

    function setup(teams) {

      var showoverflow = 0;
      var years = 0;

      teams.forEach(function (team) {

        if (team.max > team.positions) {
          var max = (team.max - team.positions);
          if (max > showoverflow) {
            showoverflow = max
          }

        }

        if (team.years.length > years) {
          years = team.years.length
        }

      });

      if (showoverflow) {
        overflow.style.height = (showoverflow * 2) + 24 + "px";
      }

      else {
        overflow.style.height = "0";
      }

      canvas.style.width = ((years + 2) * 30) + "px";
    }

    setup([data.teams[0], data.teams[1]]);


    function drawpoints(data, label, modifier) {

      currentdata[label] = data;

      modifier = modifier || '';

      points[label] = points[label] || [];
      lines[label] = lines[label] || [];

      data.years.forEach(function (year, index) {

        var point = points[label][index];
        var top;

        if (!point) {
          point = document.createElement('div');
          point.className = 'h2h__point ' + modifier;
          point.onmouseenter = showtooltip;
          point.onmouseleave = hidetooltip;
          body.appendChild(point);
          points[label].push(point);
        }

        point.setAttribute('data-label', label);
        point.setAttribute('data-tooltip', 'Position: ' + year.pos + '|Points: ' + year.points);
        point.innerText = year.pos;

        if (year.pos > 20) {
          top = "100% + " + ((year.pos - 20) * 2) + "px";
        }

        else {
          top = topc(year.pos, 20) + "%";
        }

        point.style.cssText = "top:calc(" + top + "); left:" + ((index * 30) + 30) + "px";

        var line = lines[label][index];
        if (!line) {
          line = document.createElement('div');
          line.className = 'h2h__line ' + modifier;
          line.setAttribute('data-label', label);
          body.appendChild(line);
          lines[label].push(line);
        }

        if (points[label][index - 1]) {
          drawline(points[label][index - 1], point, line);
        }
      });
    }

    function topc(val, max) {
      return (100 / max) * val
    }

    function drawline(a, b, line) {
      var pointA = {
        left: a.offsetLeft,
        top: a.offsetTop
      };

      var pointB = {
        left: b.offsetLeft,
        top: b.offsetTop
      }

      var pointAcenterX = a.offsetWidth / 2;
      var pointAcenterY = a.offsetHeight / 2;
      var pointBcenterX = b.offsetWidth / 2;
      var pointBcenterY = b.offsetHeight / 2;
      var angle = Math.atan2(pointB.top - pointA.top, pointB.left - pointA.left) * 180 / Math.PI;
      var distance = lineDistance(pointA.left, pointA.top, pointB.left, pointB.top);

      // Set Angle
      line.style.cssText = 'transform: rotate(' + angle + 'deg); width:' + distance + 'px;';

      if (pointB.left < pointA.left) {

        line.style.top = (pointA.top) + 'px';
        line.style.left = (pointB.left) + 'px';
      }

      else {
        line.style.top = (pointA.top) + 'px';
        line.style.left = (pointA.left) + 'px';
      }
    }

    function lineDistance(x, y, x0, y0) {
      return Math.sqrt((x -= x0) * x + (y -= y0) * y);
    };

    function redraw() {
      setup([currentdata.home, currentdata.away]);
      drawpoints(currentdata.home, 'home');
      drawpoints(currentdata.away, 'away');
    }

    function showtooltip(event) {
      clearTimeout(tooltip.timeout);
      var dims = event.target.getBoundingClientRect();
      tooltip.textContent = event.target.getAttribute('data-tooltip').replace(/\|/g, '\n');
      tooltip.style.cssText = "opacity:1;visibility:visible;left:" + (dims.left + (dims.width / 2)) + "px;top: " + dims.top + "px";
    }

    function hidetooltip(event) {
      tooltip.timeout = setTimeout(function () {
        tooltip.style.opacity = "0";
      }, 333);
    }

    function swipable() {
      if (rail.scrollWidth > rail.offsetWidth) {
        rail.setAttribute('data-swipable', true);
      }

      rail.onscroll = function () {
        rail.onscroll = null;
        rail.removeAttribute('data-swipable');
      }
    }


    drawpoints(data.teams[0], 'home', 'animate-in-view');
    drawpoints(data.teams[1], 'away', 'animate-in-view');


    var resize;
    window.addEventListener('resize', function () {
      clearTimeout(resize);
      resize = setTimeout(function () {
        redraw();
      }, 1000 / 3)
    })

    setTimeout(function () {
      document.querySelectorAll('.animate-in-view').forEach(function (item) {
        item.classList.remove('animate-in-view');
      })
    }, 1000)


    document.querySelectorAll('select').forEach(function (item) {
      item.onchange = function () {

        var s1 = document.querySelectorAll('select')[0];
        var s2 = document.querySelectorAll('select')[1];

        var data1 = data.teams[parseInt(s1.value, 10)];
        var data2 = data.teams[parseInt(s2.value, 10)];

        setup([data1, data2]);
        drawpoints(data1, s1.id);
        drawpoints(data2, s2.id);

      }
    });

    swipable();
  </script>
</body>

</html>