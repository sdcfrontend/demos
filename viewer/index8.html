<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
  * {
    padding: 0;
    margin: 0;
    box-sizing: border-box
  }

  @font-face {
    font-family: skytext;
    src: url(sky-regular.woff) format("woff");
  }

  html {
    scroll-behavior: smooth;
  }

body {
  color: black;
  font-family: skytext, sans-serif;
  min-height: 200vh;
  background: #eee;
}

a {
  color: inherit
}

.container {
  max-width: 996px;
  margin: 0 auto;
  position: relative;
  max-height: 100vh;
  background: #fff;
  overflow: hidden;
}

.container-inner {
  overflow: hidden;
  position: relative;
  height: 100vh;
}

.container-wrap {
  will-change: transform;
  touch-action: none !important;
  transform-origin: 50% 0;
}

.container-overlay {
  width: 100%;
  padding-bottom: 100%;
  position: relative
}

img {
  max-width: 100%;
  width: 100%;
  display: block;
  position: absolute;
  left: 0;
  top: 0;
  z-index: 2;
}

.reset {
  text-decoration: none;
  display: inline-block;
  padding: 4px 6px;
  position: absolute;
  background: #111;
  color: white;
  top: 12px;
  left: 12px;
  z-index: 100;
  visibility: hidden
}

.reset--visible {
  visibility: visible;
}

.container-wrap--zoomer {
  transition: transform 0.33s;
}

.dot {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: white;
  position: absolute;
  transform: translate(-50%,-50%);
  z-index: 4;
  transition: transform 0.33s;
  filter: drop-shadow(0 0 2px rgba(0,0,0,0.5))
}

.dot--on {
  background-color: black
}

.zoomed .dot {
  transform: translate(-50%,-50%) scale(0.5);
}

.dot:after {
  background: white;
  content: attr(title);
  display: block;
  position: absolute;
  padding: 3px 8px;
  font-size: 14px;
  left: 100%;
  margin: -2px 0 0 3px;
  white-space: nowrap;
}

.container-caption {
  position: absolute;
  width: 100%;
  bottom: 0;
  left: 0;
  display: flex;
  transition: transform 0.33s;
  transform: translateY(100%);
  pointer-events: none;
}

.container-caption-inner {
  background: white;
  flex: 1;
  border: 1px solid #ccc;
  padding: 3em;
  max-width: 600px;
  margin: 0 auto 1em;
  pointer-events: all;
  position: relative;
}

.container-caption-title {
  font-size: 1.8em;
  font-weight: 500;
  margin-bottom: 0.5em
}

.container-caption-text {
  line-height: 1.5
}

.container-caption-close {
  position: absolute;
  right: 12px;
  top: 12px;
  font-size: 25px;
  font-weight: 200;
  text-decoration: none;
}

@media all and (max-width: 600px){
  .container-inner {
    overflow: hidden;
    position: relative;
    max-height: 70vh;
  }

  .container-caption {
    height: 50%;
  }

  .container-caption-inner  {
    padding: 1.5em 1em;
    margin: 0
  }

  .container-caption-title {
    font-size: 1.4em;
  }

  .dot:after { 
    font-size: 13px;
  }
}

</style>
<script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
</head>
<body>
    <div class="container">
      <a href="#" class="reset">reset</a>
      <div class="container-inner">
        <div class="container-wrap container-wrap--zoomer">
            <div class="container-overlay"> 
              <a href="#" class="dot" title="St Petersburg" style="top: 24%;left: 31%;" data-index="0"></a>
              <a href="#" class="dot" title="Moscow" style="top: 40%;left: 21%;" data-index="1"></a>
              <a href="#" class="dot" title="Ekaterinburg" style="top: 40%;left: 71%;" data-index="2"></a>
              <a href="#" class="dot" title="Kaliningrad" style="top: 18%;left: 4%;" data-index="3"></a>
            </div>
            <img src="allmap.png" alt="" draggable="false">
        </div>
      </div>
      <div class="container-caption">
        
        <div class="container-caption-inner">
            <a href="#" class="container-caption-close">Ã—</a>
          <h4 class="container-caption-title"></h4>
          <p class="container-caption-text"></p>
        </div>
      </div>

    </div>

    
    
    <script>
    
    var container = document.querySelector('.container');
    var wrap = document.querySelector('.container-wrap');
    var overlay = document.querySelector('.container-overlay');
    var reset = document.querySelector('.reset');
    var dots = document.querySelectorAll('.dot');
    var caption = document.querySelector('.container-caption');
    var captiontitle = document.querySelector('.container-caption-title');
    var captiontext = document.querySelector('.container-caption-text');
    var close = document.querySelector('.container-caption-close');
    var selected = -1;
    var resize;

    var data = [
      {
        "title": "St Petersburg",
        "text": "Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia distinctio at accusamus nobis. Libero nam nostrum accusantium corporis eligendi temporibus, sint, tempore voluptatibus rem porro, natus nihil a ducimus iste?"
      },
      {
        "title": "Moscow",
        "text": "Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia distinctio at accusamus nobis. Libero nam nostrum accusantium corporis eligendi temporibus, sint, tempore voluptatibus rem porro, natus nihil a ducimus iste?"
      },
      {
        "title": "Ekaterinburg",
        "text": "Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia distinctio at accusamus nobis. Libero nam nostrum accusantium corporis eligendi temporibus, sint, tempore voluptatibus rem porro, natus nihil a ducimus iste?"
      },
      {
        "title": "Kaliningrad",
        "text": "Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia distinctio at accusamus nobis. Libero nam nostrum accusantium corporis eligendi temporibus, sint, tempore voluptatibus rem porro, natus nihil a ducimus iste?"
      }
    ]

    wrap.x = 0;
    wrap.y = 0;
    newx = 0;
    newy = 0;
    
    function rendercaption(close, index){
      captiontitle.textContent = data[index].title;
      captiontext.textContent = data[index].text;

      if(close){
        caption.style.cssText = "transform: translateY(100%)";
      }

      else {
        caption.style.cssText = "transform: translateY(0)";
      }
    }

    function zoom(e){

      e.preventDefault();
      
      dots.forEach(function(dot){
        dot.classList.remove('dot--on');
      });

      this.classList.add('dot--on');

      overlay.classList.add('zoomed');
      reset.classList.add('reset--visible');
      wrap.classList.add('container-wrap--zoomer');

      setTimeout(function(){
        wrap.classList.remove('container-wrap--zoomer');
      }, 400);

      var w = container.offsetWidth;
      var h = container.offsetHeight;

      var x = this.offsetLeft;
      var y = this.offsetTop;

      center(w,h,x,y);
      
      hammertime.on('panend', panend);
      hammertime.on('pan', pan);
      
      var index = parseInt(this.getAttribute('data-index', 10));
      selected = index;
      rendercaption(false, index);

    }

    function center(w,h,x,y){

      var xoffset = (w/2) - x;
      var yoffset = ((h*0.5)/4) - y;

      var coords = correctedges(xoffset, yoffset);

      requestAnimationFrame(function(){
        wrap.style.cssText = "transform: scale(2) translateX("+coords.x+"px) translateY("+coords.y+"px); cursor: move ";
      });
    
      wrap.x = coords.x;
      wrap.y = coords.y;
    }

    function correctedges(x,y){

      var newx = Math.min(x, wrap.offsetWidth/4);
      newx = Math.max(newx, (wrap.offsetWidth/4)*-1);

      var newy = Math.min(y, 0);
      newy = Math.max(newy, container.offsetHeight*-1);

      return {
        x:newx,
        y:newy
      };
    }

    function pan(ev) {

      newx = wrap.x + (ev.deltaX/2);
      newy = wrap.y + (ev.deltaY/2);

      var coords = correctedges(newx, newy);

      wrap.style.cssText = "transform: scale(2) translateX("+coords.x+"px) translateY("+coords.y+"px); cursor: move";
    };

    function panend(ev){
        wrap.x = newx;
        wrap.y = newy;
    }

    function resetmap(ev){
        wrap.classList.add('container-wrap--zoomer');
        wrap.style.cssText = "";
        hammertime.off('pan', pan);
        hammertime.off('panend', panend);
        reset.classList.remove('reset--visible');
        rendercaption(true, 0);
        overlay.classList.remove('zoomed');
        selected = -1;
    }

    var hammertime = new Hammer(wrap, {});
    reset.onclick = resetmap;
    close.onclick = resetmap;
    dots.forEach(function(dot){
      dot.onclick = zoom;
    })


  window.onresize = function(){
    clearInterval(resize);
    resize = setTimeout(function(){
      if(selected > -1){
        dots[selected].click();
      }
    }, 250)
  }
</script>
</body>
</html>