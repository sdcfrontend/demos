<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
    * {
  padding: 0;
  margin: 0;
  box-sizing: border-box
}

body {
  color: black;
  font-family: sans-serif
}

.container {
  max-width: 996px;
  margin: 0 auto;
  position: relative;
  max-height: 100vh;
  background: #fff;
  overflow: hidden;
  border: 3px solid #aaa
}

.container-inner {
  overflow: hidden;
  position: relative;
  height: 100vh;
}

.container-wrap {
  will-change: transform;
  touch-action: none !important;
  /* transition: transform 0.33s */
}

.container-overlay {
  width: 100%;
  padding-bottom: 100%;
  position: relative
}

@media all and (max-width: 600px){
  .container-inner {
    overflow: hidden;
    position: relative;
    max-height: 70vh;
  }
}

img {
  max-width: 100%;
  width: 100%;
  display: block;
  position: absolute;
  left: 0;
  top: 0;
  z-index: 2
}

.reset {
  text-decoration: none;
  display: inline-block;
  padding: 4px 6px;
  position: absolute;
  background: #ccc;
  top: 12px;
  left: 12px;
  z-index: 100;
  visibility: hidden
}

.reset--visible {
  visibility: visible;
}

.container-wrap--zoomer {
  transition: transform 0.33s;
}

.dot {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: white;
  position: absolute;
  transform: translate(-50%,-50%);
  z-index: 4;
  transition: transform 0.33s
}

.zoomed .dot {
  transform: translate(-50%,-50%) scale(0.5);
}

.dot:after {
  background: white;
  content: attr(title);
  display: block;
  position: absolute;
  padding: 3px 8px;
  font-size: 13px;
  left: 100%;
  margin: -2px 0 0 2px;
  white-space: nowrap;
}

.dot + .dot {
  top: 50%;
  left: 44%;
}

.container-caption {
  height: 40%;
  position: absolute;
  width: 100%;
  bottom: 0;
  left: 0;
  display: flex;
  transition: transform 0.33s;
  transform: translateY(100%);
}

.container-caption-inner {
  background: white;
  flex: 1;
  border: 1px solid #ccc;
  padding: 12px;
}

.container-caption-title {
  font-size: 1.4em;
  font-weight: 500;
}

p {
  margin: 1em
}

</style>
<script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
</head>
<body>
    <div class="container">
      <a href="#" class="reset">reset</a>
      <div class="container-inner">
        <div class="container-wrap container-wrap--zoomer" draggable="false">
            <div class="container-overlay"> 
              <a href="#" class="dot" draggable="false" title="St Petersburg" style="top: 24%;left: 31%;"></a>
              <a href="#" class="dot" draggable="false" title="Moscow" style="top: 40%;left: 21%;"></a>
            </div>
            <img src="allmap.png" alt="" draggable="false">
        </div>
      </div>
      <div class="container-caption">
        <div class="container-caption-inner">
          <h4 class="container-caption-title"></h4>
        </div>
      </div>

    </div>

    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia distinctio at accusamus nobis. Libero nam nostrum accusantium corporis eligendi temporibus, sint, tempore voluptatibus rem porro, natus nihil a ducimus iste?</p>
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia distinctio at accusamus nobis. Libero nam nostrum accusantium corporis eligendi temporibus, sint, tempore voluptatibus rem porro, natus nihil a ducimus iste?</p>
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia distinctio at accusamus nobis. Libero nam nostrum accusantium corporis eligendi temporibus, sint, tempore voluptatibus rem porro, natus nihil a ducimus iste?</p>
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia distinctio at accusamus nobis. Libero nam nostrum accusantium corporis eligendi temporibus, sint, tempore voluptatibus rem porro, natus nihil a ducimus iste?</p>
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia distinctio at accusamus nobis. Libero nam nostrum accusantium corporis eligendi temporibus, sint, tempore voluptatibus rem porro, natus nihil a ducimus iste?</p>
    
    
    <script>
    
   
    var wrap = document.querySelector('.container-wrap');
    var overlay = document.querySelector('.container-overlay');
    var reset = document.querySelector('.reset');
    var dots = document.querySelectorAll('.dot');
    var caption = document.querySelector('.container-caption');
    var captiontitle = document.querySelector('.container-caption-title');

    var data = [
      {
        "title": ""
      }
    ]

    wrap.x = 0;
    wrap.y = 0;
    newx = 0;
    newy = 0;
    
    function rendercaption(close, data){

      captiontitle.textContent = data.title;

      if(close){
        caption.style.cssText = "transform: translateY(100%)";
      }

      else {
        caption.style.cssText = "transform: translateY(0)";
      }
    }

    function zoom(e){

        
        if(!overlay.contains(e.target)){
          return;
        }

        e.preventDefault();

        overlay.classList.add('zoomed');

        setTimeout(function(){
          wrap.classList.remove('container-wrap--zoomer');
        }, 400);

        // wrap.onclick = null;
        reset.classList.add('reset--visible');

        var w = wrap.offsetWidth;
        var h = wrap.offsetHeight;

        var x = e.layerX;
        var y = e.layerY;

        if(e.target.className === 'dot'){
          wrap.classList.add('container-wrap--zoomer');
          x = e.target.offsetLeft;
          y = e.target.offsetTop;
          rendercaption(false, {
            title: e.target.title
          });
        }

        var xoffset = (w/2) - x;
        var yoffset = (h/2.5) - y;

        xoffset = Math.min(xoffset, wrap.offsetWidth/4);
        xoffset = Math.max(xoffset, (wrap.offsetWidth/4)*-1);

        yoffset = Math.min(yoffset, wrap.offsetHeight/4);
        yoffset = Math.max(yoffset, (wrap.offsetHeight/4)*-1);

        requestAnimationFrame(function(){
          wrap.style.cssText = "transform: scale(2) translateX("+xoffset+"px) translateY("+yoffset+"px); cursor: move ";
        });
        
        wrap.x = xoffset;
        wrap.y = yoffset;

        hammertime.on('panend', panend);
        hammertime.on('pan', pan);
    }
    
    function pan(ev) {

        newx = wrap.x + (ev.deltaX/2);
        newy = wrap.y + (ev.deltaY/2);

        newx = Math.min(newx, wrap.offsetWidth/4);
        newx = Math.max(newx, (wrap.offsetWidth/4)*-1);

        newy = Math.min(newy, wrap.offsetHeight/4);
        newy = Math.max(newy, (wrap.offsetHeight/4)*-1);

        wrap.style.cssText = "transform: scale(2) translateX("+newx+"px) translateY("+newy+"px); cursor: move"
    };

    function panend(ev){
        wrap.x = newx;
        wrap.y = newy;
    }

    function resetmap(ev){
        wrap.classList.add('container-wrap--zoomer');
        wrap.style.cssText = "";
        wrap.onclick = zoom;
        hammertime.off('pan', pan);
        hammertime.off('panend', panend);
        reset.classList.remove('reset--visible');
        rendercaption(true, {});
        overlay.classList.remove('zoomed');
    }

    var hammertime = new Hammer(wrap, {});
    reset.onclick = resetmap;
    wrap.onclick = zoom;

   


  

</script>
</body>
</html>