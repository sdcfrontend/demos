<!DOCTYPE html>
<html lang="en" class="">
  
<head>

  <meta name="viewport" id="viewport" content="width=device-width,maximum-scale=1,minimum-scale=1,minimal-ui">

  <style>
  
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
  }

  @font-face {
    font-family: skytext;
    src: url(sky-regular.woff) format("woff");
  }

  body {
    font-family: skytext;
    min-height: 3000px;
  }
  
  .view {
    position: relative;
    max-width: 640px;
    margin: 0 auto;
    border: 2px solid red;
    overflow: hidden;
    max-height: 100vh;
  }

  .view:after {
    content: "";
    padding-bottom: 125%;
    display: block;
  }
  
  .view-frame {
    background: #eee;
    position: absolute;
    height: 100%;
    width: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 2px solid limegreen;
  }
  
  .view-image {
    position: absolute;
    height: 150%;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%)
  }

  .view-overlay {
    position: absolute;
    width: 100%;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    height: 100%;
    z-index: 10;
    bordeR: 2px solid hotpink;
    transition: 0.33s transform 
    /* background: rgba(255, 0, 0, 0.297) */
  }

  .view-caption {
    background: white;
    color: black;
    padding: 0 24px;
    position: absolute;
    z-index: 11;
    line-height: 1.4;
    margin: 0;
    width: 100%;
    left: 0;
    bottom: 0%;
    height: 45%;
    transform: translateY(100%);
    transition: 0.33s transform;
    border: 1px solid #ccc;
    line-height: 1.5;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column
    /* filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.588)); */
  }

  .view-caption__next,
  .view-caption__previous {
    text-decoration: none;
    color: black;
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    display: inline-block;
    padding: 9px;
  }

  .view-caption__previous {
    right: auto;
    left: 0
  }

  .view-caption h3 {
    font-size: 1.4em;
    margin-bottom: 0.5em;
    width: 90%;
    max-width: 300px;
  }

  .view-caption p {
    width: 90%;
    max-width: 300px;
  }

  .view-spot {
    width: 26px;
    height: 26px;
    background: #053e7a;
    border-radius: 50%;
    position: absolute;
    z-index: 10;
    transform: translate(-50%,-50%);
    transform-origin: center;
    cursor: pointer;
    text-decoration: none;
    color:white;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .view-spot--open {
    background: #146bc9;
  }

  .view-caption--open {
    visibility: visible;
    opacity: 1;
    transform: translateY(0);
  }

  .view-spot--open:after {
    content: "";
    position: absolute;
    width: 10px;
    height: 10px;
    background: #fff;
    transform: rotate(45deg);
    top: calc(8px + 100%);
    z-index: 11;
    left: calc(50% - 5px);
    border: 1px solid #ccc;
    border-right: 0;
    border-bottom: 0;
    display: none;

  }

  .view-caption__close {
    position: absolute;
    top: 2px;
    right: 2px;
    z-index: 2;
    padding: 12px;
    color: black;
    text-decoration: none;
    font-size: 24px;
  }

  @media all and (max-width: 600px){
    .view-caption {
      top: 100%;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    .view-caption--open {
      top: 12px;
      left: 12px;
      width: calc(100% - 24px);
      height: calc(100% - 24px);
      margin: 0
    }

    .view-spot {
      height: 22px;
      width: 22px;
    }

    .view-spot:after {
      top: calc(10px + 100%);
    }
  }

</style>
  
</head>
  <body>
  <div class="view">
    <div class="view-frame">
        <div class="view-overlay" data-role="overlay">
          
          
          <a href="#" class="view-spot" style="left: 49.2325%; top: 12.1429%;">1</a>
          
          
          
          <a href="#" class="view-spot" style="left: 52.6316%; top: 38.0252%;">2</a>
          
         
            
            <a href="#" class="view-spot" style="left: 40.5702%; top: 51.313%;">3</a>
            
           
              
              <a href="#" class="view-spot" style="left: 26.0965%; top: 45.6933%;">4</a>
            
              
                
                <a href="#" class="view-spot" style="left: 50%; top: 63.7605%;">5</a>
            
             
                
                <a href="#" class="view-spot" style="left: 65.5%; top: 68.1261%;">6</a>
            
             
                
                <a href="#" class="view-spot" style="left: 64.3991%; top: 50.7353%;">7</a>
            
             
                <img class="view-image" src="bg.png" alt="">
              </div>
              
    </div>
    <div class="view-caption"><a href="#" class="view-caption__close">âœ•</a><h3>Highlighted headline</h3><p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quod ullam aspernatur, porro similique quos cupiditate ipsum! Temporibus, illo eaque sit harum est ex sunt expedita tempore, pariatur iure quis. Possimus.<a href="#" class="view-caption__previous"><</a><a href="#" class="view-caption__next">></a></div>
  </div>

  <script>
    var overlay = document.querySelector('[data-role="overlay"]');
    var dots = document.querySelectorAll('.view-spot');
    var image = document.querySelector('.view-image');
    var view = document.querySelector('.view');
    var frame = document.querySelector('.view-frame');
    var caption = document.querySelector('.view-caption');
    var closebutton = document.querySelector('.view-caption__close');
    var nextButtons = document.querySelectorAll('.view-caption__next');
    var prevButtons = document.querySelectorAll('.view-caption__previous');
    
    var index = 0;


    nextButtons.forEach(function(button){
      button.onclick = function(event){
        event.preventDefault();
        index ++;
        if(index > (dots.length-1)){
          index = 0
        }
        
        dots[index].click();
        dots[index].focus()
        
      }
    });

    prevButtons.forEach(function(button){
      button.onclick = function(event){
        event.preventDefault();
        
        index --;
        if(index < 0){
          index = dots.length-1;
        }

        dots[index].click();
        dots[index].focus();
        
      }
    });

    dots.forEach(function(dot, index){
      dot.onclick = function(event){
        event.preventDefault();
        positionCaption(event, dot, caption, overlay, index);
      }
    })

    
    closebutton.onclick = function(event){
      event.preventDefault();
      document.querySelector('.view-spot--open').classList.remove('view-spot--open');
      caption.classList.remove('view-caption--open');
      overlay.style.cssText = ""
    }
    

    function toPercent(value, total){
      return (100/total)*value;
    }

    function toPercentConstraint(value, parent, caption){
      var left = value;
      var dims = parent.getBoundingClientRect();
      var offset = (caption.offsetWidth + value) - dims.width;
      var marginLeft = window.getComputedStyle(caption, null).getPropertyValue('margin-left');
      marginLeft = Number(marginLeft.replace('px', ''));
      
      if(offset > 0){
        if((dims.width - left) < Math.abs(marginLeft)){
          left += Math.abs(marginLeft);
        };
        left = left - offset;
      }

      return toPercent(left, dims.width);
    }

    function positionCaption(event, dot, caption, overlay, ind){

      index = ind;

      document.querySelectorAll('.view-spot').forEach(function(item){
        if(item!==dot){
          item.classList.remove('view-spot--open');
        }
      });

      dot.classList.add('view-spot--open');
      caption.classList.add('view-caption--open');

      if(dot.classList.contains('view-spot--open')){

        var x = dot.offsetLeft;
        var y = dot.offsetTop;

        overlay.style.cssText = "transform: translate(-"+(x)+"px,"+((overlay.offsetHeight/4)-y)+"px)"
      }

      else {
        closebutton.click();
      }

      // var x = event.target.offsetLeft;
      // var y = event.target.offsetTop;
      // var css = [];
      // css.push("left:" + dot.style.left);
      // css.push("top:" + dot.style.top);

      // if(parseInt(dot.style.left, 10) > 75){
      //   css.push("transform: translateX(-60%)");
      // }

      // caption.style.cssText = css.join(";");
      // caption.style.cssText = "left:"+toPercentConstraint(x, overlay, caption)+"%;top:"+toPercent(y, overlay.offsetHeight)+"%"; 
    }

    function center(el){
      var dims = el.getBoundingClientRect();
      var y = window.pageYOffset;
      var screeny = window.innerHeight;
      var top = dims.top;
      
      window.scrollTo(0, (y + top) - (screeny/3));
    }
  </script>
  </body>
  </html>