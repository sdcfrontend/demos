!function(t){"use strict";function e(t,e,n,i,a,o){this.events=o,this.http=t,this.configs=e,this.Pixel=n,this.dom=i,this.itemId=a,this.pixelsContainerId="pixel-sdk-container",this.pixels=[]}function n(t){o(JSON.parse(t),this)}function i(t){}function a(t,e){var n=new e.Pixel(t,e.dom,e.events);n.init(),e.pixels.push(n)}function o(t,e){for(var n=e,i=0;i<t.length;i++){var o=t[i];o.html=decodeURIComponent(o.html),a(o,n)}}t.PIXEL_SDK_ENVIRONMENT="production";var s=function(){return{ENVIRONMENT:t.PIXEL_SDK_ENVIRONMENT||"development",PIXEL_SERVICE_URL:{development:"//stg-pixel.playbuzz.com/v1/item/",staging:"//stg-pixel.playbuzz.com/v1/item/",production:"//pixel.playbuzz.com/v1/item/"},PB_KINESIS:{staging:"//stg-data-collector.playbuzz.com/main/events",development:"//stg-data-collector.playbuzz.com/main/events",production:"//stg-data-collector.playbuzz.com/main/events"},ITEM_ID:(t.pbItem?t.pbItem.id:"")||(t.gameData?t.gameData.gameId:""),PAGE_LOAD_UID:t.plbzPid||t.pbPageIdentifier||"",PRELOADED_PIXELS_DATA:t.preloadedPixelsData||null}}(),c=function(){function t(t,n){return n.id&&t.setAttribute("id",n.id),n.className&&t.setAttribute("class",n.className),t.setAttribute("style",e),t}var e="display:none !important;";return{inject:function(e,n){n=n||{};var i=t(document.createElement(e),n);n.parentId&&n.content?(document.getElementById(n.parentId).appendChild(i),"iframe"===e&&(i.contentDocument.open(),i.contentDocument.write("<html><body>"+n.content+"</body></html>"),i.contentDocument.close())):document.body.appendChild(i)},dispatchEvent:function(t,e){var n=document.createEvent("CustomEvent");n.initCustomEvent(t,!1,!1,e),document.body.dispatchEvent(n)},listen:function(t,e){document.body.addEventListener(t,e)}}}(),r=function(){function t(t,e){return 4===t.readyState&&(200===t.status||(e&&e(),!1))}function e(e,n,i,a,o){var s=new XMLHttpRequest;return s.open(e,n,!0),s.onreadystatechange=function(){t(s,a)&&i&&i(s.response)},s}var n="GET",i="POST";return{get:function(t,i,a){new e(n,t,i,a).send()},post:function(t,n,a,o){var s=new e(i,t,a,o);s.setRequestHeader("Content-Type","application/json;"),s.send(n?JSON.stringify(n):null)}}}(),d=function(t,e){function n(){return(((new Date).getTime()-c)/1e3).toFixed(2)}function i(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}var a=t,o=e,s=o.PB_KINESIS[o.ENVIRONMENT],c=(new Date).getTime(),r={articleId:o.ITEM_ID,pageLoadUid:o.PAGE_LOAD_UID};return{send:function(t,e){var o={};o.deltaTime=n(),o.eventName=t,o=i(e,o,r),a.post(s,o)}}}(r,s),m=function(t,e,n){this.events=n,this.data=t,this.dom=e,this.className="sdk-pixel",this.itemEventName="pbItemEvent",this.pixelSdkEventName="pixelSdkEvent",this.macros={"{cb}":function(){return(new Date).getTime()}}};m.prototype.replaceMacros=function(t){t=t||"";var e=this;for(var n in e.macros)t.indexOf(n)>-1&&(t="function"==typeof e.macros[n]?t.replace(n,e.macros[n]()):t.replace(n,e.macros[n]));return t},m.prototype.init=function(){this.data.event.data?this.listenToDomEvents():this.inject()},m.prototype.listenToDomEvents=function(){var t=this;this.dom.listen(this.itemEventName,function(e){var n=t.matchName(e.detail.name,t.data.event.name),i=t.matchData(e.detail.data,t.data.event.data);n&&i&&t.inject()})},m.prototype.matchData=function(t,e){var n=!0;for(var i in e)void 0!==t[i]&&t[i]===e[i]||(n=!1);return n},m.prototype.matchName=function(t,e){return t===e},m.prototype.notify=function(t,e){this.events.send("pixel_injected",{pixelId:this.data.id}),this.dom.dispatchEvent(this.pixelSdkEventName,{name:t,data:e})},m.prototype.sendEvent=function(){},m.prototype.inject=function(){this.data.html=this.replaceMacros(this.data.html),this.dom.inject("iframe",{id:this.data.id,className:this.className,content:this.data.html,parentId:"pixel-sdk-container"}),this.notify("pixel-sdk.pixel.injected",this.data)},e.prototype.init=function(){var t=this;if(this.dom.inject("div",{id:this.pixelsContainerId}),t.configs.PRELOADED_PIXELS_DATA)o(t.configs.PRELOADED_PIXELS_DATA,t);else{var e=t.configs.PIXEL_SERVICE_URL[t.configs.ENVIRONMENT]+this.itemId;this.http.get(e,n.bind(t),i)}},new e(r,s,m,c,s.ITEM_ID,d).init()}(window);